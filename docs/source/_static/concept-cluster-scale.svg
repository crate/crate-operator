<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1899px" preserveAspectRatio="none" style="width:667px;height:1899px;" version="1.1" viewBox="0 0 667 1899" width="667px" zoomAndPan="magnify"><defs><filter height="300%" id="fj2w6ncmclpwe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="232" cy="20" fill="#000000" filter="url(#fj2w6ncmclpwe)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="313" x="75.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="22" x="85.5" y="71.1387">Get</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="111.5" y="71.1387">total_number_of_nodes</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="91" x="262.5" y="71.1387">of cluster from</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="21" x="357.5" y="71.1387">old</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="194" x="135" y="103.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="174" x="145" y="125.1074">Wait for cluster to be healty</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="269" x="97.5" y="206.3398"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="46" x="107.5" y="227.4785">Update</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="157.5" y="227.4785">total_number_of_nodes</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="308.5" y="227.4785">with diff</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="162" y="308.7109"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="120" x="172" y="329.8496">Update StatefulSet</text><path d="M446,369.4648 L446,393.1641 L426,397.1641 L446,401.1641 L446,424.8633 A0,0 0 0 0 446,424.8633 L613,424.8633 A0,0 0 0 0 613,424.8633 L613,379.4648 L603,369.4648 L446,369.4648 A0,0 0 0 0 446,369.4648 " fill="#FBFB77" filter="url(#fj2w6ncmclpwe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M603,369.4648 L603,379.4648 L613,379.4648 L603,369.4648 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="452" y="386.5317">This is so intermitted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="452" y="401.6646">node restarts don't</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="452" y="416.7974">reset the cluster state.</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="388" x="38" y="373.1953"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="368" x="48" y="394.334">Patch "".spec.template.spec.containers['crate'].command"</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="198" x="48" y="408.3027">with new total number of nodes</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="51.5,260.3086,412.5,260.3086,424.5,272.3086,412.5,284.3086,51.5,284.3086,39.5,272.3086,51.5,260.3086" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="294.519">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="51.5" y="276.1167">CRD</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="189" x="78.5" y="276.1167">.spec.nodes.master.replicas</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="39" x="271.5" y="276.1167">!= STS</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="314.5" y="276.1167">.spec.replicas</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="232,444.8633,244,456.8633,232,468.8633,220,456.8633,232,444.8633" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FFC0CB" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="163.5" y="537.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="173.5" y="558.4043">Wait for some time</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="67.5,488.8633,396.5,488.8633,408.5,500.8633,396.5,512.8633,67.5,512.8633,55.5,500.8633,67.5,488.8633" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="523.0737">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="329" x="67.5" y="504.6714">new nodes missing in crate or old nodes present in crate</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="78,157.9375,386,157.9375,398,169.9375,386,181.9375,78,181.9375,66,169.9375,78,157.9375" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="192.1479">yes</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="78" y="173.7456">diff</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="276" x="110" y="173.7456">changes the number of dedicated master nodes</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="232,613.2344,244,625.2344,232,637.2344,220,625.2344,232,613.2344" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="269" x="97.5" y="701.2344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="46" x="107.5" y="722.373">Update</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="157.5" y="722.373">total_number_of_nodes</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="308.5" y="722.373">with diff</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="162" y="803.6055"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="120" x="172" y="824.7441">Update StatefulSet</text><path d="M446,864.3594 L446,888.0586 L426,892.0586 L446,896.0586 L446,919.7578 A0,0 0 0 0 446,919.7578 L613,919.7578 A0,0 0 0 0 613,919.7578 L613,874.3594 L603,864.3594 L446,864.3594 A0,0 0 0 0 446,864.3594 " fill="#FBFB77" filter="url(#fj2w6ncmclpwe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M603,864.3594 L603,874.3594 L613,874.3594 L603,864.3594 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="452" y="881.4263">This is so intermitted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="452" y="896.5591">node restarts don't</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="452" y="911.6919">reset the cluster state.</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="388" x="38" y="868.0898"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="368" x="48" y="889.2285">Patch "".spec.template.spec.containers['crate'].command"</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="198" x="48" y="903.1973">with new total number of nodes</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="51.5,755.2031,412.5,755.2031,424.5,767.2031,412.5,779.2031,51.5,779.2031,39.5,767.2031,51.5,755.2031" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="789.4136">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="51.5" y="771.0112">CRD</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="189" x="78.5" y="771.0112">.spec.nodes.data.*.replicas</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="39" x="271.5" y="771.0112">!= STS</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="314.5" y="771.0112">.spec.replicas</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="232,939.7578,244,951.7578,232,963.7578,220,951.7578,232,939.7578" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FFC0CB" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="163.5" y="1032.1602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="173.5" y="1053.2988">Wait for some time</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="67.5,983.7578,396.5,983.7578,408.5,995.7578,396.5,1007.7578,67.5,1007.7578,55.5,995.7578,67.5,983.7578" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="1017.9683">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="329" x="67.5" y="999.5659">new nodes missing in crate or old nodes present in crate</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="106.5,657.2344,357.5,657.2344,369.5,669.2344,357.5,681.2344,106.5,681.2344,94.5,669.2344,106.5,657.2344" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="251" x="106.5" y="673.0425">Find next node_spec in diff that's a scale-up</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="269" x="97.5" y="1174.1289"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="46" x="107.5" y="1195.2676">Update</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="157.5" y="1195.2676">total_number_of_nodes</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="308.5" y="1195.2676">with diff</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="155.5" y="1324.9023"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="133" x="165.5" y="1346.041">Deallocate old nodes</text><rect fill="#FFC0CB" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="163.5" y="1393.3711"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="173.5" y="1414.5098">Wait for some time</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="107,1276.5,357,1276.5,369,1288.5,357,1300.5,107,1300.5,95,1288.5,107,1276.5" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="1310.7104">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="250" x="107" y="1292.3081">old nodes in crate and shards on old nodes</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="162" y="1490.5273"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="120" x="172" y="1511.666">Update StatefulSet</text><path d="M446,1540.7656 L446,1564.4648 L426,1568.4648 L446,1572.4648 L446,1596.1641 A0,0 0 0 0 446,1596.1641 L613,1596.1641 A0,0 0 0 0 613,1596.1641 L613,1550.7656 L603,1540.7656 L446,1540.7656 A0,0 0 0 0 446,1540.7656 " fill="#FBFB77" filter="url(#fj2w6ncmclpwe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M603,1540.7656 L603,1550.7656 L613,1550.7656 L603,1540.7656 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="452" y="1557.8325">This is so intermitted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="452" y="1572.9653">node restarts don't</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="452" y="1588.0981">reset the cluster state.</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="388" x="38" y="1544.4961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="368" x="48" y="1565.6348">Patch "".spec.template.spec.containers['crate'].command"</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="198" x="48" y="1579.6035">with new total number of nodes</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="51.5,1228.0977,412.5,1228.0977,424.5,1240.0977,412.5,1252.0977,51.5,1252.0977,39.5,1240.0977,51.5,1228.0977" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="1262.3081">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="51.5" y="1243.9058">CRD</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="189" x="78.5" y="1243.9058">.spec.nodes.data.*.replicas</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="39" x="271.5" y="1243.9058">!= STS</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="314.5" y="1243.9058">.spec.replicas</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="232,1616.1641,244,1628.1641,232,1640.1641,220,1628.1641,232,1616.1641" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FFC0CB" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="163.5" y="1708.5664"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="173.5" y="1729.7051">Wait for some time</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="67.5,1660.1641,396.5,1660.1641,408.5,1672.1641,396.5,1684.1641,67.5,1684.1641,55.5,1672.1641,67.5,1660.1641" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="236" y="1694.3745">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="329" x="67.5" y="1675.9722">new nodes missing in crate or old nodes present in crate</text><polygon fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" points="98.5,1130.1289,365.5,1130.1289,377.5,1142.1289,365.5,1154.1289,98.5,1154.1289,86.5,1142.1289,98.5,1130.1289" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="267" x="98.5" y="1145.937">Find next node_spec in diff that's a scale-down</text><rect fill="#FEFECE" filter="url(#fj2w6ncmclpwe)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="142.5" y="1806.5352"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="159" x="152.5" y="1827.6738">Acknowledge node check</text><ellipse cx="232" cy="1871.5039" fill="#FFFFFF" filter="url(#fj2w6ncmclpwe)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="232" cy="1871.5039" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="30" y2="50"/><polygon fill="#A80036" points="228,40,232,50,236,40,232,44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="83.9688" y2="103.9688"/><polygon fill="#A80036" points="228,93.9688,232,103.9688,236,93.9688,232,97.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="342.6797" y2="373.1953"/><polygon fill="#A80036" points="228,363.1953,232,373.1953,236,363.1953,232,367.1953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="284.3086" y2="308.7109"/><polygon fill="#A80036" points="228,298.7109,232,308.7109,236,298.7109,232,302.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="424.5" x2="623" y1="272.3086" y2="272.3086"/><polygon fill="#A80036" points="619,352.6797,623,362.6797,627,352.6797,623,356.6797" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="623" x2="623" y1="272.3086" y2="456.8633"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="623" x2="244" y1="456.8633" y2="456.8633"/><polygon fill="#A80036" points="254,452.8633,244,456.8633,254,460.8633,250,456.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="421.1328" y2="444.8633"/><polygon fill="#A80036" points="228,434.8633,232,444.8633,236,434.8633,232,438.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="240.3086" y2="260.3086"/><polygon fill="#A80036" points="228,250.3086,232,260.3086,236,250.3086,232,254.3086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="512.8633" y2="537.2656"/><polygon fill="#A80036" points="228,527.2656,232,537.2656,236,527.2656,232,531.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="408.5" x2="420.5" y1="500.8633" y2="500.8633"/><polygon fill="#A80036" points="416.5,541.25,420.5,551.25,424.5,541.25,420.5,545.25" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="500.8633" y2="593.2344"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="232" y1="593.2344" y2="593.2344"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="593.2344" y2="613.2344"/><polygon fill="#A80036" points="228,603.2344,232,613.2344,236,603.2344,232,607.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="468.8633" y2="488.8633"/><polygon fill="#A80036" points="228,478.8633,232,488.8633,236,478.8633,232,482.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="181.9375" y2="206.3398"/><polygon fill="#A80036" points="228,196.3398,232,206.3398,236,196.3398,232,200.3398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="398" x2="641" y1="169.9375" y2="169.9375"/><polygon fill="#A80036" points="637,392.082,641,402.082,645,392.082,641,396.082" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="641" x2="641" y1="169.9375" y2="625.2344"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="641" x2="244" y1="625.2344" y2="625.2344"/><polygon fill="#A80036" points="254,621.2344,244,625.2344,254,629.2344,250,625.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="137.9375" y2="157.9375"/><polygon fill="#A80036" points="228,147.9375,232,157.9375,236,147.9375,232,151.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="837.5742" y2="868.0898"/><polygon fill="#A80036" points="228,858.0898,232,868.0898,236,858.0898,232,862.0898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="779.2031" y2="803.6055"/><polygon fill="#A80036" points="228,793.6055,232,803.6055,236,793.6055,232,797.6055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="424.5" x2="623" y1="767.2031" y2="767.2031"/><polygon fill="#A80036" points="619,847.5742,623,857.5742,627,847.5742,623,851.5742" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="623" x2="623" y1="767.2031" y2="951.7578"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="623" x2="244" y1="951.7578" y2="951.7578"/><polygon fill="#A80036" points="254,947.7578,244,951.7578,254,955.7578,250,951.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="916.0273" y2="939.7578"/><polygon fill="#A80036" points="228,929.7578,232,939.7578,236,929.7578,232,933.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="735.2031" y2="755.2031"/><polygon fill="#A80036" points="228,745.2031,232,755.2031,236,745.2031,232,749.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1007.7578" y2="1032.1602"/><polygon fill="#A80036" points="228,1022.1602,232,1032.1602,236,1022.1602,232,1026.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="408.5" x2="643" y1="995.7578" y2="995.7578"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="643" x2="643" y1="669.2344" y2="995.7578"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="643" x2="369.5" y1="669.2344" y2="669.2344"/><polygon fill="#A80036" points="379.5,665.2344,369.5,669.2344,379.5,673.2344,375.5,669.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="963.7578" y2="983.7578"/><polygon fill="#A80036" points="228,973.7578,232,983.7578,236,973.7578,232,977.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="681.2344" y2="701.2344"/><polygon fill="#A80036" points="228,691.2344,232,701.2344,236,691.2344,232,695.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="94.5" x2="24" y1="669.2344" y2="669.2344"/><polygon fill="#A80036" points="20,880.9766,24,890.9766,28,880.9766,24,884.9766" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="24" y1="669.2344" y2="1110.1289"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="232" y1="1110.1289" y2="1110.1289"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1110.1289" y2="1130.1289"/><polygon fill="#A80036" points="228,1120.1289,232,1130.1289,236,1120.1289,232,1124.1289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="637.2344" y2="657.2344"/><polygon fill="#A80036" points="228,647.2344,232,657.2344,236,647.2344,232,651.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1358.8711" y2="1393.3711"/><polygon fill="#A80036" points="228,1383.3711,232,1393.3711,236,1383.3711,232,1387.3711" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1300.5" y2="1324.9023"/><polygon fill="#A80036" points="228,1314.9023,232,1324.9023,236,1314.9023,232,1318.9023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="369" x2="381" y1="1288.5" y2="1288.5"/><polygon fill="#A80036" points="377,1363.3711,381,1373.3711,385,1363.3711,381,1367.3711" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="381" x2="381" y1="1288.5" y2="1457.7422"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="381" x2="232" y1="1457.7422" y2="1457.7422"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1457.7422" y2="1490.5273"/><polygon fill="#A80036" points="228,1480.5273,232,1490.5273,236,1480.5273,232,1484.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1524.4961" y2="1544.4961"/><polygon fill="#A80036" points="228,1534.4961,232,1544.4961,236,1534.4961,232,1538.4961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1252.0977" y2="1276.5"/><polygon fill="#A80036" points="228,1266.5,232,1276.5,236,1266.5,232,1270.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="424.5" x2="623" y1="1240.0977" y2="1240.0977"/><polygon fill="#A80036" points="619,1436.5547,623,1446.5547,627,1436.5547,623,1440.5547" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="623" x2="623" y1="1240.0977" y2="1628.1641"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="623" x2="244" y1="1628.1641" y2="1628.1641"/><polygon fill="#A80036" points="254,1624.1641,244,1628.1641,254,1632.1641,250,1628.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1592.4336" y2="1616.1641"/><polygon fill="#A80036" points="228,1606.1641,232,1616.1641,236,1606.1641,232,1610.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1208.0977" y2="1228.0977"/><polygon fill="#A80036" points="228,1218.0977,232,1228.0977,236,1218.0977,232,1222.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1684.1641" y2="1708.5664"/><polygon fill="#A80036" points="228,1698.5664,232,1708.5664,236,1698.5664,232,1702.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="408.5" x2="643" y1="1672.1641" y2="1672.1641"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="643" x2="643" y1="1142.1289" y2="1672.1641"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="643" x2="377.5" y1="1142.1289" y2="1142.1289"/><polygon fill="#A80036" points="387.5,1138.1289,377.5,1142.1289,387.5,1146.1289,383.5,1142.1289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1640.1641" y2="1660.1641"/><polygon fill="#A80036" points="228,1650.1641,232,1660.1641,236,1650.1641,232,1654.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1154.1289" y2="1174.1289"/><polygon fill="#A80036" points="228,1164.1289,232,1174.1289,236,1164.1289,232,1168.1289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="86.5" x2="24" y1="1142.1289" y2="1142.1289"/><polygon fill="#A80036" points="20,1467.7422,24,1477.7422,28,1467.7422,24,1471.7422" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="24" y1="1142.1289" y2="1786.5352"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="232" y1="1786.5352" y2="1786.5352"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1786.5352" y2="1806.5352"/><polygon fill="#A80036" points="228,1796.5352,232,1806.5352,236,1796.5352,232,1800.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232" x2="232" y1="1840.5039" y2="1860.5039"/><polygon fill="#A80036" points="228,1850.5039,232,1860.5039,236,1850.5039,232,1854.5039" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[aa1aa718c4002ac434838995effb1be7]
@startuml concept-cluster-scale

start

:Get ""total_number_of_nodes"" of cluster from ""old"";

:Wait for cluster to be healty;

if (""diff"" changes the number of dedicated master nodes) then (yes)
    :Update ""total_number_of_nodes"" with diff;

    if (CRD "".spec.nodes.master.replicas"" != STS "".spec.replicas"") then (yes)
        :Update StatefulSet;

        :Patch "".spec.template.spec.containers['crate'].command"
        with new total number of nodes;
        note right: This is so intermitted\nnode restarts don't\nreset the cluster state.
    endif

    if (new nodes missing in crate or old nodes present in crate) then (yes)
        #pink:Wait for some time;
        kill
    endif
endif

while (Find next node_spec in diff that's a scale-up)
    :Update ""total_number_of_nodes"" with diff;

    if (CRD "".spec.nodes.data.*.replicas"" != STS "".spec.replicas"") then (yes)
        :Update StatefulSet;

        :Patch "".spec.template.spec.containers['crate'].command"
        with new total number of nodes;
        note right: This is so intermitted\nnode restarts don't\nreset the cluster state.
    endif

    if (new nodes missing in crate or old nodes present in crate) then (yes)
        #pink:Wait for some time;
        kill
    endif
endwhile

while (Find next node_spec in diff that's a scale-down)
    :Update ""total_number_of_nodes"" with diff;

    if (CRD "".spec.nodes.data.*.replicas"" != STS "".spec.replicas"") then (yes)
        if (old nodes in crate and shards on old nodes) then (yes)
            :Deallocate old nodes;

            #pink:Wait for some time;
            kill
        endif
        :Update StatefulSet;

        :Patch "".spec.template.spec.containers['crate'].command"
        with new total number of nodes;
        note right: This is so intermitted\nnode restarts don't\nreset the cluster state.
    endif

    if (new nodes missing in crate or old nodes present in crate) then (yes)
        #pink:Wait for some time;
        kill
    endif
endwhile

:Acknowledge node check;

stop

@enduml

PlantUML version 1.2020.19(Mon Oct 12 17:10:01 CEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>